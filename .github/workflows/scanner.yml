name: Pre-Market Breakout Screen v2

on:
  workflow_dispatch:
  schedule:
    # 10:15 UTC = 5:15am ET during Standard Time (adjust if needed)
    - cron: "15 10 * * 1-5"

jobs:
  run-screen:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Show repo contents (debug)
        run: |
          echo "PWD: $(pwd)"
          ls -la

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

            - name: Run v2 pre-market breakout screen (swing_scanner_v2.py)
        env:
          POLYGON_API_KEY:       ${{ secrets.POLYGON_API_KEY }}
          TELEGRAM_BOT_TOKEN:    ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID:      ${{ secrets.TELEGRAM_CHAT_ID }}

          ADR_PERIOD: "14"
          MA_FAST: "10"
          MA_SLOW: "22"
          AVG_VOL_LOOKBACK: "30"
          RS_LOOKBACK_MONTHS: "6"
          HIGH_LOOKBACK_DAYS: "120"

          MIN_ADR_PCT: "5"
          MAX_ADR_PCT: "12"
          MIN_AVG_VOL_30D: "30000000"
          MIN_PRICE: "1.0"
          MIN_RS_PCTILE: "0.98"

          PREFILTER_MIN_PRICE: "3.0"
          PREFILTER_MIN_AVG_VOL5: "5000000"
          PREFILTER_TOP_N_BY_DOLLAR_VOL: "1200"

          MAX_BASE_DEPTH_PCT: "35"
          MAX_DIST_FROM_HIGH_PCT: "8"
          MAX_DIST_FROM_22SMA_PCT: "15"

          VCP_SHORT: "10"
          VCP_LONG: "40"
          MIN_VCP_RATIO: "0.2"
          MAX_VCP_RATIO: "0.7"

          TOP_N_TO_REPORT: "40"
          TOP_N_PREVIEW: "20"
          POLYGON_SLEEP_SECONDS: "0.02"
        run: |
          echo "=== Repo contents ==="
          ls -la
          echo "=== Running swing_scanner_v2.py ==="
          python swing_scanner_v2.py

      - name: List files (debug)
        if: always()
        run: ls -la

      - name: Upload CSV artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: breakout-v2-results
          path: |
            allus_breakout_v2_*.csv
            allus_breakout_v2_preview_*.csv
